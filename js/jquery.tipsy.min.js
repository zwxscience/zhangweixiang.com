(function(C){function A(D){if(D.attr("title")||typeof(D.attr("original-title"))!="string"){D.attr("original-title",D.attr("title")||"").removeAttr("title")}}function B(E,D){this.$element=C(E);this.options=D;this.enabled=true;A(this.$element)}B.prototype={show:function(){var G=this.getTitle();if(G&&this.enabled){var J=this.tip();J.find(".tipsy-inner")[this.options.html?"html":"text"](G);J[0].className="tipsy";J.remove().css({top:0,left:0,visibility:"hidden",display:"block"}).appendTo(document.body);var F=C.extend({},this.$element.offset(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight});var H=J[0].offsetWidth,I=J[0].offsetHeight;var D=(typeof this.options.gravity=="function")?this.options.gravity.call(this.$element[0]):this.options.gravity;var E;switch(D.charAt(0)){case"n":E={top:F.top+F.height+this.options.offset,left:F.left+F.width/2-H/2};break;case"s":E={top:F.top-I-this.options.offset,left:F.left+F.width/2-H/2};break;case"e":E={top:F.top+F.height/2-I/2,left:F.left-H-this.options.offset};break;case"w":E={top:F.top+F.height/2-I/2,left:F.left+F.width+this.options.offset};break}if(D.length==2){if(D.charAt(1)=="w"){E.left=F.left+F.width/2-15}else{E.left=F.left+F.width/2-H+15}}J.css(E).addClass("tipsy-"+D);if(this.options.fade){J.stop().css({opacity:0,display:"block",visibility:"visible"}).animate({opacity:this.options.opacity})}else{J.css({visibility:"visible",opacity:this.options.opacity})}}},hide:function(){if(this.options.fade){this.tip().stop().fadeOut(function(){C(this).remove()})}else{this.tip().remove()}},getTitle:function(){var E,F=this.$element,D=this.options;A(F);var E,D=this.options;if(typeof D.title=="string"){E=F.attr(D.title=="title"?"original-title":D.title)}else{if(typeof D.title=="function"){E=D.title.call(F[0])}}E=(""+E).replace(/(^\s*|\s*$)/,"");return E||D.fallback},tip:function(){if(!this.$tip){this.$tip=C('<div class="tipsy"></div>').html('<div class="tipsy-arrow"></div><div class="tipsy-inner"/></div>')}return this.$tip},validate:function(){if(!this.$element[0].parentNode){this.hide();this.$element=null;this.options=null}},enable:function(){this.enabled=true},disable:function(){this.enabled=false},toggleEnabled:function(){this.enabled=!this.enabled}};C.fn.tipsy=function(H){if(H===true){return this.data("tipsy")}else{if(typeof H=="string"){return this.data("tipsy")[H]()}}H=C.extend({},C.fn.tipsy.defaults,H);function E(L){var K=C.data(L,"tipsy");if(!K){K=new B(L,C.fn.tipsy.elementOptions(L,H));C.data(L,"tipsy",K)}return K}function I(){var K=E(this);K.hoverState="in";if(H.delayIn==0){K.show()}else{setTimeout(function(){if(K.hoverState=="in"){K.show()}},H.delayIn)}}function G(){var K=E(this);K.hoverState="out";if(H.delayOut==0){K.hide()}else{setTimeout(function(){if(K.hoverState=="out"){K.hide()}},H.delayOut)}}if(!H.live){this.each(function(){E(this)})}if(H.trigger!="manual"){var D=H.live?"live":"bind",F=H.trigger=="hover"?"mouseenter":"focus",J=H.trigger=="hover"?"mouseleave":"blur";this[D](F,I)[D](J,G)}return this};C.fn.tipsy.defaults={delayIn:0,delayOut:0,fade:false,fallback:"",gravity:"n",html:false,live:false,offset:0,opacity:0.8,title:"title",trigger:"hover"};C.fn.tipsy.elementOptions=function(E,D){return C.metadata?C.extend({},D,C(E).metadata()):D};C.fn.tipsy.autoNS=function(){return C(this).offset().top>(C(document).scrollTop()+C(window).height()/2)?"s":"n"};C.fn.tipsy.autoWE=function(){return C(this).offset().left>(C(document).scrollLeft()+C(window).width()/2)?"e":"w"}})(jQuery);